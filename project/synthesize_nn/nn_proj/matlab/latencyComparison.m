%% Data
baseline = [73,20,21,21,21,21,21,21,21,23,21,21,21,21,21,21,21,23,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,23,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,23,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21];
sw = [404327,402696,402534,402470,402450,402433,402435,402482,402495,402510,402511,402488,402426,402462,402425,402507,402355,402446,402469,402501,402543,402547,402494,402343,402362,402448,402389,402540,402448,402598,402462,402500,402474,402424,402450,402425,402462,402480,402489,402428,402574,402509,402411,402581,402434,402488,402604,402520,402468,402459,402585,402366,402457,402532,402588,402441,402464,402492,402475,402538,402429,402420,402455,402459,402569,402433,402421,402427,402404,402419,402611,402493,402586,402447,402446,402514,402512,402405,402468,402387,402457,402591,402546,402495,402454,402511,402497,402417,402523,402498,402432,402559,402514,402590,402478,402591,402485,402477,402486,402345,402469,402378,402456,402480,402497,402479,402453,402462,402555,402566,402529,402424,402556,402538,402448,402423,402480,402492,402312,402537,402483,402504,402427,402532,402569,402471,402425,402532,402346,402524,402463,402451,402550,402541,402359,402547,402533,402532,402547,402499,402442,402507,402426,402543,402420,402491,402462,402475,402428,402477,402460,402456,402513,402431,402406,402459,402495,402480,402473,402459,402552,402484,402523,402455,402530,402507,402516,402503,402441,402392,402434,402407,402478,402537,402407,402458,402497,402405,402431,402539,402499,402550,402490,402392,402373,402430,402362,402499,402469,402454,402455,402399,402400,402485,402493,402429,402521,402495,402457,402501,402611,402426,402445,402433,402465,402491,402506,402385,402495,402421,402421,402521,402456,402531,402552,402344,402551,402447,402559,402485,402489,402581,402454,402496,402529,402505,402462,402339,402522,402543,402554,402523,402595,402542,402534,402452,402511,402448,402483,402531,402415,402402,402378,402520,402458,402486,402545,402466,402450,402432,402378,402558,402524,402441,402516,402461,402512,402450,402491,402562,402406,402517,402622,402483,402498,402440,402457,402451,402519,402521,402433,402473,402528,402495,402460,402549,402364,402420,402416,402411,402458,402523,402391,402577,402565,402387,402521,402467,402448,402485,402457,402444,402473,402500,402514,402506,402582,402427,402515,402569,402444,402450,402453,402431,402478,402504,402411,402480,402440,402540,402556,402490,402564,402423,402435,402379,402483,402498,402472,402532,402513,402549,402435,402396,402465,402358,402514,402418,402499,402550,402573,402396,402490,402395,402494,402456,402466,402484,402473,402519,402528,402514,402476,402554,402380,402485,402528,402482,402552,402425,402523,402496,402516,402456,402504,402502,402606,402454,402593,402387,402369,402317,402507,402546,402452,402483,402390,402519,402415,402472,402442,402521,402464,402495,402366,402519,402467,402405,402484,402578,402543,402496,402504,402563,402460,402510,402437,402402,402397,402478,402588,402494,402460,402432,402529,402416,402521,402427,402519,402436,402479,402435,402522,402510,402539,402537,402572,402561,402433,402488,402570,402501,402444,402483,402478,402491,402421,402420,402582,402571,402408,402543,402389,402491,402474,402468,402338,402510,402448,402453,402543,402425,402518,402475,402456,402448,402488,402471,402517,402511,402472,402469,402597,402549,402459,402469,402438,402469,402568,402457,402423,402428,402569,402559,402465,402561,402482,402426,402576,402500,402460,402582,402553,402491,402500,402496,402477,402466,402438,402470,402502,402441,402345,402572,402386,402452,402563,402446,402482,402438,402581,402481,402485,402449,402390,402519,402519,402560,402480,402463,402463,402474,402458,402448,402571,402552,402521,402494,402383,402531,402550,402457,402448,402354,402469,402466,402416,402549,402548,402450,402607,402503,402414,402523,402446,402584,402490,402476,402482,402470,402442,402520,402431,402343,402509,402583,402530,402459,402423,402496,402305,402426,402475,402512,402424,402411,402590,402385,402506,402427,402498,402410,402460,402451,402421,402412,402519,402465,402528,402493,402476,402490,402440,402534,402466,402461,402500,402521,402501,402489,402464,402427,402432,402473,402478,402487,402451,402338,402374,402562,402429,402539,402417,402518,402470,402493,402441,402566,402498,402494,402397,402525,402605,402558,402474,402351,402534,402494,402489,402536,402542,402453,402528,402533,402541,402407,402477,402507,402452,402548,402493,402411,402499,402414,402450,402401,402590,402459,402490,402522,402390,402568,402397,402514,402513,402478,402450,402461,402407,402409,402520,402437,402477,402600,402422,402571,402303,402529,402428,402492,402364,402578,402481,402467,402452,402488,402528,402432,402467,402455,402397,402507,402568,402483,402469,402443,402428,402458,402442,402539,402421,402461,402472,402519,402487,402450,402522,402520,402479,402536,402525,402430,402526,402456,402441,402430,402310,402551,402493,402459,402417,402522,402482,402461,402408,402526,402514,402513,402587,402455,402581,402335,402528,402457,402597,402494,402644,402502,402671,402452,402585,402482,402405,402352,402482,402522,402539,402534,402386,402431,402573,402383,402518,402398,402480,402451,402437,402523,402538,402398,402647,402358,402490,402517,402424,402460,402606,402496,402549,402474,402575,402568,402580,402519,402500,402359,402461,402469,402510,402447,402466,402494,402466,402555,402412,402555,402456,402482,402416,402371,402396,402422,402497,402478,402531,402543,402559,402458,402473,402582,402499,402479,402548,402537,402452,402423,402501,402540,402550,402452,402530,402417,402441,402438,402530,402450,402435,402486,402455,402468,402492,402527,402500,402543,402553,402460,402520,402459,402459,402475,402480,402491,402404,402414,402540,402504,402499,402391,402460,402563,402507,402509,402467,402457,402447,402488,402512,402425,402503,402541,402459,402481,402465,402501,402460,402409,402509,172418];
hw = [634600,633857,633842,633819,633819,633814,633816,633832,633826,633814,633816,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,633819,633825,470013];
hw_nowait = [54390,54340,54341,54315,54324,54314,54324,54314,54316,54310,54315,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314,54318,54313,54314];

baseline_median = median(baseline)
sw_median = median(sw)-baseline_median
hw_median = median(hw)-baseline_median
hw_nowait_median = median(hw_nowait)-baseline_median
hw_resulting_median = hw_median - hw_nowait_median
medians = [sw_median, hw_nowait_median, hw_resulting_median]

% Clocks
arm_clk = 650*10e6;
timer_clk = 325*10e6;
fpga_clk = 100*10e6;
timer2arm = @(x) round(arm_clk./timer_clk * x);
timer2fpga = @(x) round(fpga_clk./timer_clk * x);

arm_medians = [timer2arm(sw_median),timer2arm(hw_nowait_median),NaN];
fpga_medians = [NaN,NaN,timer2fpga(hw_resulting_median)];

%% Bar chart
labels = [1*ones(1,length(sw)),2*ones(1,length(hw)),3*ones(1,length(hw_nowait))];
l_num = [1,2,3];
l_names = {'SW','HW_{SW overhead}','HW_{resulting}'};

h1 = figure(1)
bar(categorical(l_num,l_num,l_names),...
    [medians;...
     arm_medians; ...
     fpga_medians;...
    ]')

text(1:length(medians),medians,num2str(medians'),'vert','bottom','horiz','right'); 
text([1,2],arm_medians([1,2]),num2str(arm_medians([1,2])'),'vert','bottom','horiz','center'); 
text([3],fpga_medians(3),num2str(fpga_medians(3)'),'vert','bottom','horiz','left'); 
box off
grid on
legend('Timer cycles', 'ARM cycles', 'FPGA cycles')
ylabel('Cycles')
title('Implementation lantencies (median)')

%% Save
saveas(gcf,'figures/latencyBars.fig')
set(h1,'Units','Inches');
pos = get(h1,'Position');
set(h1,'PaperPositionMode','Auto','PaperUnits','Inches','PaperSize',[pos(3), pos(4)])
print(h1,'figures/latencyBars','-dpdf','-r0')